"use-strict";angular.module("eventPlan",["ngRoute","firebase"]),angular.module("eventPlan").config(["$locationProvider","$routeProvider",function(e,t){e.hashPrefix("!"),t.when("/",{templateUrl:"templates/home.html",controller:"SignUpController",controllerAs:"vm"}).when("/main",{templateUrl:"templates/main.html"}).when("/edit-profile",{templateUrl:"templates/edit-profile.html",controller:"EditProfileController",controllerAs:"vm"}).when("/events",{templateUrl:"templates/browse-events.html",controller:"BrowseEventsController",controllerAs:"vm"}).when("/create-event",{templateUrl:"templates/create-event.html",controller:"CreateEventController",controllerAs:"vm"})}]),angular.module("eventPlan").controller("BrowseEventsController",["$scope","$http","$log","$window","$firebaseObject","$firebaseArray",function(e,t,a,r,n,s){var o=this,i=firebase.database().ref().child("events");o.events=s(i),o.signOut=function(){firebase.auth().signOut(),localStorage.clear(),a.log("signed out"),r.open("/","_self")}}]),angular.module("eventPlan").controller("CreateEventController",["$scope","$http","$window","$log","$firebaseObject","$firebaseArray","UserAuthService","IssueTracker",function(e,t,a,r,n,s,o,i){var l=this,u=(new o,firebase.database().ref().child("events")),d=s(u),c=firebase.database().ref().child("users"),v=n(c);l.eventData={},l.eventData.eventGuests=[],l.eventData.mapCenter={},v.$loaded().then(function(e){var t=e[firebase.auth().currentUser.uid];l.eventData.eventHost=t.username,l.eventData.hostAvatar=t.avatar})["catch"](function(e){r.error("usrObject error: ",e)}),$("#inp-event-start-time").datetimepicker(),$("#inp-event-end-time").datetimepicker(),l.autoAddress=function(){var t=document.getElementById("inp-event-location"),a={types:["address"]};e.addrAoutocomplete=new google.maps.places.Autocomplete(t,a)},l.getEventStartTime=function(e){l.eventData.eventStartTime=e.target.value},l.getEventEndTime=function(e){l.eventData.eventEndTime=e.target.value},l.getEventAddress=function(){r.log("$scope.addrAoutocomplete.getPlace(): ",e.addrAoutocomplete.getPlace());var t=e.addrAoutocomplete.getPlace();angular.isDefined(t)&&(l.eventData.eventLocation=t.name,r.log("vm.eventData.eventLocation: ",l.eventData.eventLocation))},l.geocode=function(e){if(angular.isDefined(e)){var a=e;r.log("geocode address: ",a)}var n=t({method:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?address="+a+"&key=AIzaSyCXcFHRjLncSzc1UBklhRueyStZdZHaELA"}).then(function(e){l.eventData.mapCenter=e.data.results[0].geometry.location,r.log("geocode response: ",e.data.results[0].geometry.location)},function(e){r.log("geocode error: ",e)});return n},l.addGuest=function(e){l.eventData.eventGuests.push(e)},l.removeGuest=function(e){r.log("remove ",e),l.eventData.eventGuests.splice(e,1)},l.checkValidation=function(){var e,t=new i;return angular.isUndefined(l.eventData.eventName)&&t.add("Please name your event."),angular.isUndefined(l.eventData.eventType)&&t.add("Please select a type of event."),angular.isUndefined(l.eventData.eventStartTime)&&t.add("When will your event begin?"),angular.isUndefined(l.eventData.eventEndTime)&&t.add("When will your event end?"),angular.isUndefined(l.eventData.eventLocation)&&t.add("Where will your event be held?"),r.log("issues: ",t.retrieve()),0===t.issues.length?e=!0:(e=!1,l.issues=t.issues),r.log("status: ",e),t.clearIssues(),e},l.saveEvent=function(){l.geocode(l.getEventAddress()).then(function(){l.checkValidation()?d.$add(l.eventData).then(function(e){a.open("#!/events","_self")})["catch"](function(e){r.log("error: ",e)}):r.log("error")},function(e){r.log("error: ",e)})},l.signOut=function(){firebase.auth().signOut(),localStorage.clear(),r.log("signed out"),a.open("/","_self")}}]),angular.module("eventPlan").controller("EditProfileController",["$scope","$window","$log","$timeout","UserAuthService","$firebaseObject",function(e,t,a,r,n,s){var o=this,i=new n,l=firebase.database().ref().child("users"),u=s(l);o.userData={},u.$loaded().then(function(e){var t=firebase.auth().currentUser.uid,r=e[t];if(a.log("from syncObject: ",r),o.userData.uid=t,r.username)o.userData.username=r.username;else{var n=firebase.auth().currentUser.email;o.userData.username=n.substr(0,n.indexOf("@")),i.setOne(t,"username",o.userData.username)}if(angular.isUndefined(r.name)?o.userData.name="no name":o.userData.name=r.name,o.userData.email=r.email||firebase.auth().currentUser.email,angular.isUndefined(r.avatar)){o.firstLetter=o.userData.email.toLowerCase().trim().split("")[0];var s=(16777215*Math.random()<<0).toString(16);o.userData.avatar="https://avatars.discourse.org/v2/letter/"+o.firstLetter+"/"+s+"/",i.setOne(t,"avatar",o.userData.avatar)}else o.userData.avatar=r.avatar})["catch"](function(e){a.log("syncObject error: ",e)}),u.$bindTo(e,"users"),o.signOut=function(){firebase.auth().signOut(),localStorage.clear(),a.log("signed out"),t.open("/","_self")},o.saveUserData=function(){var e=o.userData,t=o.userData.uid;a.log("data from saveUserData: ",e),i.setData(t,e)},o.resetPassword=function(){},o.getUserAvatar=function(){},o.getUserData=function(){a.log("db data: ",u)}}]),angular.module("eventPlan").controller("NavBarController",["$scope","$window","$log",function(e,t,a){}]),angular.module("eventPlan").controller("SignInController",["$scope","$window","$log","Auth","IssueTracker",function(e,t,a,r,n){var s=this;s.signIn=function(e,n,o){s.firebaseUser=null,s.error=null,o&&r.$signInWithEmailAndPassword(e,n).then(function(e){s.firebaseUser=e,t.open("#!/edit-profile","_self")})["catch"](function(e){a.log("login error message: ",e.message,e.code),s.error=e.message})},s.checValidation=function(){var e,t=new n;return angular.isUndefined(s.email)&&t.add("Pleas enter your email."),angular.isUndefined(s.password)&&t.add("Pleas enter your password."),0===t.issues.length?e=!0:(e=!1,s.issues=t.issues),t.clearIssues(),e}}]),angular.module("eventPlan").controller("SignUpController",["$scope","$window","$log","IssueTracker","PasswordStrengthMeter","UserAuthService","Auth","$firebaseObject",function(e,t,a,r,n,s,o,i){var l=this;l.data={};var u=new r,d=new s;l.checkValidation=function(){var e;angular.isUndefined(l.data.name)&&u.add("Pleas enter your name."),angular.isUndefined(l.data.email)&&u.add("Please enter a vallid email address."),angular.isUndefined(l.data.password1)&&u.add("Pleas create a password."),l.data.password1!==l.data.password2&&u.add("Passwords do not match."),l.data.password1&&l.data.password1.length<6&&u.add("Passwords must be at least 6 characters.");var t=u.retrieve();return a.log(t),a.log("issues array: ",u.retrieveIssueArray()),0===u.issues.length?e=!0:(e=!1,l.issues=u.issues),u.clearIssues(),e},l.createAccount=function(e){l.message=null,l.error=null,e===!0&&o.$createUserWithEmailAndPassword(l.data.email,l.data.password1).then(function(e){l.message="User created with uid: "+d.uid,d.setData(e.uid,l.data),t.open("#!/edit-profile","_self")})["catch"](function(e){l.error=e})};var c=new n;l.passwordStrength=function(e){return l.passwordProgress=c.passTest(e),l.passwordProgress=l.passwordProgress+"%",l.passwordProgress}}]),angular.module("eventPlan").directive("editProfileDirective",function(){return{templateUrl:"templates/partials/sec-edit-profile.html",controller:"EditProfileController",controllerAs:"vm"}}),angular.module("eventPlan").directive("navBarDirective",function(){return{templateUrl:"templates/partials/navbar.html"}}),angular.module("eventPlan").directive("signInDirective",function(){return{templateUrl:"templates/partials/sign-in.html",controller:"SignInController",controllerAs:"vm"}}),angular.module("eventPlan").directive("signUpDirective",function(){return{templateUrl:"templates/partials/sign-up.html",controller:"SignUpController",controllerAs:"vm"}}),angular.module("eventPlan").factory("Auth",["$firebaseAuth",function(e){return e()}]),angular.module("eventPlan").factory("IssueTracker",function(){function e(){this.issues=[]}return e.prototype={add:function(e){this.issues.push(e)},retrieve:function(){var e="";switch(this.issues.length){case 0:break;case 1:e="Please fix the following issue:\n"+this.issues[0];break;default:e="Please fix the following issues:\n"+this.issues.join("\n")}return e},retrieveIssueArray:function(){return this.issues},clearIssues:function(){return this.issues=[]}},e}),angular.module("eventPlan").factory("PasswordStrengthMeter",["$log",function(e){function t(){this.points={reccomendedChars:/[\!\@\#\$\%\^\&\*]/,hasLower:/[a-z]/,hasUpper:/[A-Z]/,hasNumber:/[0-9]/,notEmail:""}}return t.prototype={passTest:function(e){var t=0;if(e){e=e.split("");var a=this.points.reccomendedChars.test(e);return a===!0&&(t+=20),this.points.hasLower.test(e)&&(t+=20),this.points.hasUpper.test(e)&&(t+=20),this.points.hasNumber.test(e)&&(t+=20),e.length>=6&&(t+=20),t}}},t}]),angular.module("eventPlan").factory("UserAuthService",["$log",function(e){function t(){this.data={}}return t.prototype={setData:function(e,t){firebase.database().ref("users/"+e).set(t)},setOne:function(e,t,a){firebase.database().ref("users/"+e+"/"+t).set(a)},getUserData:function(t){firebase.database().ref("users/"+t).on("value",function(t){return e.log("db snapshot: ",t.val()),t.val()})}},t}]);
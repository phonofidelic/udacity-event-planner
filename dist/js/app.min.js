"use-strict";angular.module("eventPlan",["ngRoute","firebase","ui.bootstrap.datetimepicker","ui.dateTimeInput"]),angular.module("eventPlan").config(["$locationProvider","$routeProvider",function(e,t){e.hashPrefix("!"),t.when("/",{templateUrl:"templates/home.html",controller:"SignUpController",controllerAs:"vm"}).when("/main",{templateUrl:"templates/main.html"}).when("/edit-profile",{templateUrl:"templates/edit-profile.html",controller:"EditProfileController",controllerAs:"vm"}).when("/events",{templateUrl:"templates/browse-events.html",controller:"BrowseEventsController",controllerAs:"vm"}).when("/create-event",{templateUrl:"templates/create-event.html",controller:"CreateEventController",controllerAs:"vm"})}]),angular.module("eventPlan").directive("editProfileDirective",function(){return{templateUrl:"templates/partials/sec-edit-profile.html",controller:"EditProfileController",controllerAs:"vm"}}),angular.module("eventPlan").directive("navBarDirective",function(){return{templateUrl:"templates/partials/navbar.html"}}),angular.module("eventPlan").directive("signInDirective",function(){return{templateUrl:"templates/partials/sign-in.html",controller:"SignInController",controllerAs:"vm"}}),angular.module("eventPlan").directive("signUpDirective",function(){return{templateUrl:"templates/partials/sign-up.html",controller:"SignUpController",controllerAs:"vm"}}),angular.module("eventPlan").controller("BrowseEventsController",["$scope","$http","$log","$window","$firebaseObject","$firebaseArray","UserAuthService",function(e,t,a,n,r,s,o){var i=this,l=new o,u=firebase.database().ref().child("events");i.events=s(u),i.signOut=function(){l.signOut()}}]),angular.module("eventPlan").controller("CreateEventController",["$scope","$http","$window","$log","$firebaseObject","$firebaseArray","UserAuthService","IssueTracker",function(e,t,a,n,r,s,o,i){var l=this,u=new o,d=firebase.database().ref().child("events"),c=s(d),v=firebase.database().ref().child("users"),m=r(v);l.eventData={},l.eventData.eventGuests=[],l.eventData.mapCenter={},m.$loaded().then(function(e){var t=e[firebase.auth().currentUser.uid];l.eventData.eventHost=t.username,l.eventData.hostAvatar=t.avatar})["catch"](function(e){n.error("usrObject error: ",e)}),angular.element("#inp-event-start-time").datetimepicker(),angular.element("#inp-event-end-time").datetimepicker(),l.autoAddress=function(){var t=document.getElementById("inp-event-location"),a={types:["address"]};e.addrAoutocomplete=new google.maps.places.Autocomplete(t,a)},l.getEventStartTime=function(){var e=angular.element("#inp-event-start-time").val();l.eventData.eventStartTime=moment(e).format("dddd, MM-DD-YYYY"),l.eventData.eventStartTimeEpoch=moment(e).valueOf()},l.getEventEndTime=function(e){var t=angular.element("#inp-event-end-time").val();l.eventData.eventEndTime=moment(t).format("dddd, MM-DD-YYYY"),l.eventData.eventEndTimeEpoch=moment(t).valueOf()},l.getEventAddress=function(){n.log("$scope.addrAoutocomplete.getPlace(): ",e.addrAoutocomplete.getPlace());var t=e.addrAoutocomplete.getPlace();angular.isDefined(t)&&(l.eventData.eventLocation=t.name,n.log("vm.eventData.eventLocation: ",l.eventData.eventLocation))},l.geocode=function(e){if(angular.isDefined(e)){var a=e;n.log("geocode address: ",a)}var r=t({method:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?address="+a+"&key=AIzaSyCXcFHRjLncSzc1UBklhRueyStZdZHaELA"}).then(function(e){l.eventData.mapCenter=e.data.results[0].geometry.location,n.log("geocode response: ",e.data.results[0].geometry.location)},function(e){n.log("geocode error: ",e)});return r},l.addGuest=function(e){l.eventData.eventGuests.push(e)},l.removeGuest=function(e){n.log("remove ",e),l.eventData.eventGuests.splice(e,1)},l.checkValidation=function(){var e,t=new i;return angular.isUndefined(l.eventData.eventHost)&&t.add("Who will host your event?."),angular.isUndefined(l.eventData.eventName)&&t.add("Please name your event."),angular.isUndefined(l.eventData.eventType)&&t.add("Please select a type of event."),angular.isUndefined(l.eventData.eventStartTime)&&t.add("When will your event begin?"),angular.isUndefined(l.eventData.eventEndTime)&&t.add("When will your event end?"),l.eventData.eventStartTimeEpoch>l.eventData.eventEndTimeEpoch&&t.add("Sorry, your event cannot start before it begins."),angular.isUndefined(l.eventData.eventLocation)&&t.add("Where will your event be held?"),n.log("issues: ",t.retrieve()),0===t.issues.length?e=!0:(e=!1,l.issues=t.issues),n.log("status: ",e),t.clearIssues(),e},l.saveEvent=function(){l.geocode(l.getEventAddress()).then(function(){l.checkValidation()?c.$add(l.eventData).then(function(e){a.open("#!/events","_self")})["catch"](function(e){n.log("error: ",e)}):n.log("error")},function(e){n.log("error: ",e)})},l.signOut=function(){u.signOut()}}]),angular.module("eventPlan").controller("EditProfileController",["$scope","$window","$log","$timeout","UserAuthService","$firebaseObject",function(e,t,a,n,r,s){var o=this,i=new r,l=firebase.database().ref().child("users"),u=s(l);o.userData={},u.$loaded().then(function(e){var t=firebase.auth().currentUser.uid,n=e[t];if(a.log("from syncObject: ",n),o.userData.uid=t,n.username)o.userData.username=n.username;else{var r=firebase.auth().currentUser.email;o.userData.username=r.substr(0,r.indexOf("@")),i.setOne(t,"username",o.userData.username)}if(angular.isUndefined(n.name)?o.userData.name="no name":o.userData.name=n.name,o.userData.email=n.email||firebase.auth().currentUser.email,angular.isUndefined(n.avatar)){o.firstLetter=o.userData.email.toLowerCase().trim().split("")[0];var s=(16777215*Math.random()<<0).toString(16);o.userData.avatar="https://avatars.discourse.org/v2/letter/"+o.firstLetter+"/"+s+"/",i.setOne(t,"avatar",o.userData.avatar)}else o.userData.avatar=n.avatar})["catch"](function(e){a.log("syncObject error: ",e)}),u.$bindTo(e,"users"),o.signOut=function(){i.signOut()},o.saveUserData=function(){var e=o.userData,t=o.userData.uid;a.log("data from saveUserData: ",e),i.setData(t,e)},o.resetPassword=function(){},o.getUserAvatar=function(){},o.getUserData=function(){a.log("db data: ",u)}}]),angular.module("eventPlan").controller("NavBarController",["$scope","$window","$log",function(e,t,a){}]),angular.module("eventPlan").controller("SignInController",["$scope","$window","$log","Auth","IssueTracker",function(e,t,a,n,r){var s=this;s.signIn=function(e,r,o){s.firebaseUser=null,s.error=null,o&&n.$signInWithEmailAndPassword(e,r).then(function(e){s.firebaseUser=e,t.open("#!/edit-profile","_self")})["catch"](function(e){a.log("login error message: ",e.message,e.code),s.error=e.message})},s.checValidation=function(){var e,t=new r;return angular.isUndefined(s.email)&&t.add("Please enter your email."),angular.isUndefined(s.password)&&t.add("Please enter your password."),0===t.issues.length?e=!0:(e=!1,s.issues=t.issues),t.clearIssues(),e}}]),angular.module("eventPlan").controller("SignUpController",["$scope","$window","$log","IssueTracker","PasswordStrengthMeter","UserAuthService","Auth","$firebaseObject",function(e,t,a,n,r,s,o,i){var l=this;l.data={},l.privateData={};var u=new n,d=new s;l.checkValidation=function(){var e;angular.isUndefined(l.data.name)&&u.add("Please enter your name."),angular.isUndefined(l.data.email)&&u.add("Please enter a vallid email address."),angular.isUndefined(l.privateData.password1)&&u.add("Please create a password."),l.privateData.password1!==l.privateData.password2&&u.add("Passwords do not match."),l.privateData.password1&&l.privateData.password1.length<6&&u.add("Passwords must be at least 6 characters.");var t=u.retrieve();return a.log(t),a.log("issues array: ",u.retrieveIssueArray()),0===u.issues.length?e=!0:(e=!1,l.issues=u.issues),u.clearIssues(),e},l.createAccount=function(e){l.message=null,l.error=null,e===!0&&o.$createUserWithEmailAndPassword(l.data.email,l.privateData.password1).then(function(e){l.message="User created with uid: "+e.uid,d.setData(e.uid,l.data),t.open("#!/edit-profile","_self")})["catch"](function(e){l.error=e})};var c=new r;l.passwordStrength=function(e){return l.passwordProgress=c.passTest(e),l.passwordProgress=l.passwordProgress+"%",l.passwordProgress}}]),angular.module("eventPlan").factory("Auth",["$firebaseAuth",function(e){return e()}]),angular.module("eventPlan").factory("IssueTracker",function(){function e(){this.issues=[]}return e.prototype={add:function(e){this.issues.push(e)},retrieve:function(){var e="";switch(this.issues.length){case 0:break;case 1:e="Please fix the following issue:\n"+this.issues[0];break;default:e="Please fix the following issues:\n"+this.issues.join("\n")}return e},retrieveIssueArray:function(){return this.issues},clearIssues:function(){return this.issues=[]}},e}),angular.module("eventPlan").factory("PasswordStrengthMeter",["$log",function(e){function t(){this.points={reccomendedChars:/[\!\@\#\$\%\^\&\*]/,hasLower:/[a-z]/,hasUpper:/[A-Z]/,hasNumber:/[0-9]/,notEmail:""}}return t.prototype={passTest:function(e){var t=0;if(e){e=e.split("");var a=this.points.reccomendedChars.test(e);return a===!0&&(t+=20),this.points.hasLower.test(e)&&(t+=20),this.points.hasUpper.test(e)&&(t+=20),this.points.hasNumber.test(e)&&(t+=20),e.length>=6&&(t+=20),t}}},t}]),angular.module("eventPlan").factory("UserAuthService",["$log","$window",function(e,t){function a(){this.data={}}return a.prototype={setData:function(e,t){firebase.database().ref("users/"+e).set(t)},setOne:function(e,t,a){firebase.database().ref("users/"+e+"/"+t).set(a)},getUserData:function(t){firebase.database().ref("users/"+t).on("value",function(t){return e.log("db snapshot: ",t.val()),t.val()})},signOut:function(){firebase.auth().signOut(),localStorage.clear(),t.open("/#!/","_self")}},a}]);
"use-strict";angular.module("eventPlan",["ngRoute","firebase"]),angular.module("eventPlan").config(["$locationProvider","$routeProvider",function(e,t){e.hashPrefix("!"),t.when("/",{templateUrl:"templates/home.html"}).when("/main",{templateUrl:"templates/main.html"}).when("/edit-profile",{templateUrl:"templates/edit-profile.html",controller:"EditProfileController",controllerAs:"vm"}).when("/events",{templateUrl:"templates/browse-events.html",controller:"BrowseEventsController",controllerAs:"vm"}).when("/create-event",{templateUrl:"templates/create-event.html",controller:"CreateEventController",controllerAs:"vm"})}]),angular.module("eventPlan").controller("BrowseEventsController",["$scope","$http","$log","$window","$firebaseObject","$firebaseArray","UserAuthService",function(e,t,a,n,r,s,o){var i=this,l=new o,u=firebase.database().ref().child("events");i.events=s(u),i.signOut=function(){l.signOut()}}]),angular.module("eventPlan").controller("CreateEventController",["$scope","$http","$window","$log","$firebaseObject","$firebaseArray","UserAuthService","IssueTracker","CheckValidationService",function(e,t,a,n,r,s,o,i,l){var u=this,c=new o,d=firebase.database().ref().child("events"),v=s(d),m=firebase.database().ref().child("users"),f=r(m);u.eventData={},u.eventData.eventGuests=[],u.eventData.mapCenter={},u.checkValidationService=new l,f.$loaded().then(function(e){var t=e[firebase.auth().currentUser.uid];u.eventData.eventHost=t.username,u.eventData.hostAvatar=t.avatar})["catch"](function(e){n.error("usrObject error: ",e)}),angular.element("#inp-event-start-time").datetimepicker(),angular.element("#inp-event-end-time").datetimepicker(),u.autoAddress=function(){var t=document.getElementById("inp-event-location"),a={types:["address"]};e.addrAoutocomplete=new google.maps.places.Autocomplete(t,a)},u.getEventStartTime=function(){var e=angular.element("#inp-event-start-time").val();u.eventData.eventStartTime=moment(e).format("dddd, MM-DD-YYYY"),u.eventData.eventStartTimeEpoch=moment(e).valueOf()},u.getEventEndTime=function(e){var t=angular.element("#inp-event-end-time").val();u.eventData.eventEndTime=moment(t).format("dddd, MM-DD-YYYY"),u.eventData.eventEndTimeEpoch=moment(t).valueOf()},u.getEventAddress=function(){n.log("$scope.addrAoutocomplete.getPlace(): ",e.addrAoutocomplete.getPlace());var t=e.addrAoutocomplete.getPlace();angular.isDefined(t)?(u.eventData.eventLocation=t.name,n.log("vm.eventData.eventLocation: ",u.eventData.eventLocation)):u.eventData.eventLocation=angular.element("#inp-event-location").val()},u.geocode=function(e){if(angular.isDefined(e)){var a=e;n.log("geocode address: ",a)}var r=t({method:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?address="+a+"&key=AIzaSyCXcFHRjLncSzc1UBklhRueyStZdZHaELA"}).then(function(e){u.eventData.mapCenter=e.data.results[0].geometry.location,n.log("geocode response: ",e.data.results[0].geometry.location)},function(e){n.log("geocode error: ",e)});return r},u.addGuest=function(e){u.eventData.eventGuests.push(e)},u.removeGuest=function(e){n.log("remove ",e),u.eventData.eventGuests.splice(e,1)},u.checkTimeDelta=function(){u.eventData.eventStartTimeEpoch>=u.eventData.eventEndTimeEpoch?u.validation.eventTimeDelta=!1:u.validation.eventTimeDelta=!0},u.checkGuestList=function(){0===u.eventData.eventGuests.length&&(u.validation.eventGuestList=!1)},u.checkValidation=function(){var e,t=new i;return angular.isUndefined(u.eventData.eventHost)&&t.add("Who will host your event?."),angular.isUndefined(u.eventData.eventName)&&t.add("Please name your event."),angular.isUndefined(u.eventData.eventType)&&t.add("Please select a type of event."),angular.isUndefined(u.eventData.eventStartTime)&&t.add("When will your event begin?"),angular.isUndefined(u.eventData.eventEndTime)&&t.add("When will your event end?"),u.eventData.eventStartTimeEpoch>=u.eventData.eventEndTimeEpoch&&t.add("Event end time must be later than start time."),angular.isUndefined(u.eventData.eventLocation)&&t.add("Where will your event be held?"),u.eventData.eventGuests<1&&t.add("Please add some guests to your event."),n.log("issues: ",t.retrieve()),0===t.issues.length?e=!0:(e=!1,u.issues=t.issues),n.log("status: ",e),t.clearIssues(),e},u.saveEvent=function(){u.geocode(u.getEventAddress()).then(function(){u.checkValidation()?v.$add(u.eventData).then(function(e){a.open("#!/events","_self")})["catch"](function(e){n.log("error: ",e)}):n.log("error")},function(e){n.log("error: ",e)})},u.submit=function(){u.submitted=!0},u.signOut=function(){c.signOut()}}]),angular.module("eventPlan").controller("EditProfileController",["$scope","$window","$log","$timeout","UserAuthService","$firebaseObject","FocusService",function(e,t,a,n,r,s,o){var i=this,l=new r,u=firebase.database().ref().child("users"),c=s(u);i.userData={},i.focusService=new o,c.$loaded().then(function(e){var t=firebase.auth().currentUser.uid,n=e[t];if(a.log("from syncObject: ",n),i.userData.uid=t,n.username)i.userData.username=n.username;else{var r=firebase.auth().currentUser.email;i.userData.username=r.substr(0,r.indexOf("@")),l.setOne(t,"username",i.userData.username)}if(angular.isUndefined(n.name)?i.userData.name="no name":i.userData.name=n.name,i.userData.email=n.email||firebase.auth().currentUser.email,angular.isUndefined(n.avatar)){i.firstLetter=i.userData.email.toLowerCase().trim().split("")[0];var s=(16777215*Math.random()<<0).toString(16);i.userData.avatar="https://avatars.discourse.org/v2/letter/"+i.firstLetter+"/"+s+"/",l.setOne(t,"avatar",i.userData.avatar)}else i.userData.avatar=n.avatar})["catch"](function(e){a.log("syncObject error: ",e)}),c.$bindTo(e,"users"),i.signOut=function(){l.signOut()},i.saveUserData=function(){var e=i.userData,t=i.userData.uid;a.log("data from saveUserData: ",e),l.setData(t,e)}}]),angular.module("eventPlan").controller("HomeController",["$scope","$timeout","$window","$log","FocusService",function(e,t,a,n,r){e.focusService=new r}]),angular.module("eventPlan").controller("NavBarController",["$scope","FocusService",function(e,t){e.focusService=new t}]),angular.module("eventPlan").controller("SignInController",["$scope","$window","$log","Auth","IssueTracker","CheckValidationService",function(e,t,a,n,r,s){var o=this;o.checkValidationService=new s,o.signIn=function(e,r,s){o.firebaseUser=null,o.error=null,s&&n.$signInWithEmailAndPassword(e,r).then(function(e){o.firebaseUser=e,t.open("#!/edit-profile","_self")})["catch"](function(e){a.log("login error message: ",e.message,e.code),o.error=e.message})},o.checValidation=function(){var e,t=new r;return angular.isUndefined(o.email)&&t.add("Please enter your email."),angular.isUndefined(o.password)&&t.add("Please enter your password."),0===t.issues.length?e=!0:(e=!1,o.issues=t.issues),t.clearIssues(),e}}]),angular.module("eventPlan").controller("SignUpController",["$scope","$window","$log","IssueTracker","PasswordStrengthMeter","UserAuthService","Auth","$firebaseObject","CheckValidationService",function(e,t,a,n,r,s,o,i,l){var u=this;u.data={},u.privateData={},u.checkValidationService=new l;var c=new n,d=new s;u.checkValidation=function(){var e;angular.isUndefined(u.data.name)&&c.add("Please enter your name."),angular.isUndefined(u.data.email)&&c.add("Please enter a vallid email address."),angular.isUndefined(u.privateData.password1)&&c.add("Please create a password."),u.privateData.password1!==u.privateData.password2&&c.add("Passwords do not match."),u.privateData.password1&&u.privateData.password1.length<6&&c.add("Passwords must be at least 6 characters.");var t=c.retrieve();return a.log(t),a.log("issues array: ",c.retrieveIssueArray()),0===c.issues.length?e=!0:(e=!1,u.issues=c.issues),c.clearIssues(),e},u.createAccount=function(e){u.message=null,u.error=null,e===!0&&o.$createUserWithEmailAndPassword(u.data.email,u.privateData.password1).then(function(e){u.message="User created with uid: "+e.uid,d.setData(e.uid,u.data),t.open("#!/edit-profile","_self")})["catch"](function(e){u.error=e})};var v=new r;u.passwordStrength=function(e){return u.passwordStatus=v.passTest(e),u.passwordProgress=u.passwordStatus.strength,u.passwordProgress=u.passwordProgress+"%",u.passwordProgress}}]),angular.module("eventPlan").directive("editProfileDirective",function(){return{templateUrl:"templates/partials/sec-edit-profile.html",controller:"EditProfileController",controllerAs:"vm"}}),angular.module("eventPlan").directive("navBarDirective",function(){return{templateUrl:"templates/partials/navbar.html"}}),angular.module("eventPlan").directive("signInDirective",function(){return{templateUrl:"templates/partials/sign-in.html",controller:"SignInController",controllerAs:"vm"}}),angular.module("eventPlan").directive("signUpDirective",function(){return{templateUrl:"templates/partials/sign-up.html",controller:"SignUpController",controllerAs:"vm"}}),angular.module("eventPlan").factory("Auth",["$firebaseAuth",function(e){return e()}]),angular.module("eventPlan").factory("CheckValidationService",["$log",function(e){function t(){var e={};e.email="Please enter a vallid email address.",e.passwordLength="Passwords must be at least 6 characters."}return t.prototype={validate:function(e,t){var a;switch(t){case"text":a=!!angular.isDefined(e);break;case"email":var n=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;a=!!n.test(e);break;case"password":a=!!(angular.isDefined(e)&&e.length>5);break;default:a=!1}return a}},t}]),angular.module("eventPlan").factory("FocusService",["$timeout","$log",function(e,t){function a(){}return a.prototype.focus=function(a){e(function(){angular.element(a).focus()},100),t.log("focus")},a}]),angular.module("eventPlan").factory("IssueTracker",function(){function e(){this.issues=[]}return e.prototype={add:function(e){this.issues.push(e)},retrieve:function(){var e="";switch(this.issues.length){case 0:break;case 1:e="Please fix the following issue:\n"+this.issues[0];break;default:e="Please fix the following issues:\n"+this.issues.join("\n")}return e},retrieveIssueArray:function(){return this.issues},clearIssues:function(){return this.issues=[]}},e}),angular.module("eventPlan").factory("PasswordStrengthMeter",["$log",function(e){function t(){this.points={reccomendedChars:/[\!\@\#\$\%\^\&\*]/,hasLower:/[a-z]/,hasUpper:/[A-Z]/,hasNumber:/[0-9]/,notEmail:""}}return t.prototype={passTest:function(t){var a={};if(a.strength=0,t){t=t.split("");var n=this.points.reccomendedChars.test(t);return n===!0&&(a.strength+=20,a.characters=!0),this.points.hasLower.test(t)&&(a.strength+=20,a.hasLower=!0),this.points.hasUpper.test(t)&&(a.strength+=20,a.hasUpper=!0),this.points.hasNumber.test(t)&&(a.strength+=20,a.hasNumber=!0),t.length>=6&&(a.strength+=20,a.length=!0),e.log("password: ",a),a}}},t}]),angular.module("eventPlan").factory("UserAuthService",["$log","$window",function(e,t){function a(){this.data={}}return a.prototype={setData:function(e,t){firebase.database().ref("users/"+e).set(t)},setOne:function(e,t,a){firebase.database().ref("users/"+e+"/"+t).set(a)},getUserData:function(t){firebase.database().ref("users/"+t).on("value",function(t){return e.log("db snapshot: ",t.val()),t.val()})},signOut:function(){firebase.auth().signOut(),localStorage.clear(),t.open("/#!/","_self")}},a}]);